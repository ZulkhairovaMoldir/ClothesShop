<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Product Details</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script>
        const API_BASE = "http://localhost:8080";

        async function fetchProductDetails() {
            const urlParams = new URLSearchParams(window.location.search);
            const productId = urlParams.get("id");

            if (!productId) {
                alert("Ошибка: Неверный ID товара!");
                window.location.href = "/index.html";
                return;
            }

            try {
                const res = await fetch(`${API_BASE}/products/${productId}`);
                if (!res.ok) throw new Error("Ошибка загрузки товара");

                const product = await res.json();
                document.getElementById("product-name").textContent = product.Name;
                document.getElementById("product-image").src = product.image_url;
                document.getElementById("product-description").textContent = product.Description;
                document.getElementById("product-price").textContent = `$${product.Price}`;
                document.getElementById("add-to-cart").setAttribute("onclick", `addToCart(${product.ID})`);
            } catch (error) {
                console.error("Ошибка:", error);
                document.getElementById("product-details").innerHTML = "<p>Ошибка загрузки товара.</p>";
            }
        }

        function addToCart(productID) {
            fetch(`${API_BASE}/cart/add`, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ product_id: productID, quantity: 1 })  // Исправлено product_id
            })
                .then(res => {
                    if (!res.ok) throw new Error("Ошибка добавления в корзину");
                    return res.json();
                })
                .then(() => {
                    alert("✅ Товар добавлен в корзину!");
                    window.location.href = "/static/cart.html";
                })
                .catch(error => console.error("Ошибка:", error));
        }


        window.onload = fetchProductDetails;
    </script>
</head>
<body>
<div class="container mt-5">
    <h1 id="product-name"></h1>
    <img id="product-image" class="img-fluid" style="max-width: 400px;" />
    <p id="product-description"></p>
    <p><strong>Цена:</strong> <span id="product-price"></span></p>

    <button id="add-to-cart" class="btn btn-primary mt-3">Добавить в корзину</button>
</div>
</body>
</html>
